{"version":3,"names":["YetiTable","this","tableHasFilters","rowsThatPassFiltering","utils","generateUniqueId","head","rows","body","watchContentsHandler","newValue","oldValue","console","error","markRowsWithChangedRowActions","setHeadingColumnIndices","setBodyColumnIndices","handlePaginationUpdate","ev","paginator","target","numRecordsToDisplay","recordsDisplayed","paginateSelf","firstRecordIndexToDisplay","startIndex","tablePaginate","emit","currentPage","detail","handleReadyToVerify","targetGeneric","columnIndex","parseInt","getAttribute","nodeName","toLowerCase","picker","handleDateFilterChange","multiselect","type","handleMultiselectFilterChange","handleMenuButtonChange","menuButton","rowIndex","rowActionClick","actionLabel","handleCellRadioChange","cell","contents","row","forEach","isSelected","iLoveJSX","cellRadioChange","setFiltersActiveFlag","filtersAreActive","i","cells","length","filtering","value","undefined","oldContents","cellIndex","rowActions","isEqual","rowActionsJustChanged","isValidTableData","data","isValidJSON","JSON","stringify","parse","setSortableOnCellsOtherThanTheOneWithThisIndex","ths","th","sortDirection","setDefaultFilterValues","handleSort","preventDefault","sortSelf","tableSort","sortContentsPerHeaderCell","sort","a","b","aValue","bValue","aType","getStringifiedType","bType","sortModifier","castToNumber","aDate","Date","bDate","handleTextFilterChange","e","input","key","stopImmediatePropagation","handleTextFilterSearch","filterSelf","paginationComponent","selectedPage","tableFilter","handleTextFilterButtonClick","handleTextFilterClear","handleSelectFilterChange","select","selectedIndex","isValid","control","handleClearAllFilters","doesRowPassFiltering","doesCellPassFiltering","isFilterable","filterValue","indexOf","getTime","filterValuesArray","split","includes","getNumberOfRecords","renderCell","id","isClearCell","renderFilterClearCell","renderRowActionsCell","isRadio","renderRadioCell","isHeading","renderTableHeading","css","cssClass","template","h","class","innerHTML","preexistingMenuButtonElement","document","querySelector","controlId","timesUpdated","actions","action","actionId","href","label","push","tooltipText","radioName","tableId","radioValue","isRowChecked","Object","assign","name","onChange","checked","text","onClick","headingLabelId","sortableHeading","filter","a11yText","iconKey","renderTableHeadingFilter","scope","title","filterId","inputIdString","inputClass","onKeyUp","that","onSearchFieldClear","el","inputId","labeledBy","selectOptions","options","selected","optionId","showErrorTooltip","multiselectOptions","optionLabel","optionIsSelected","optionProperties","placeholder","renderRow","renderHeaderRow","renderRows","rowStartIndex","rowsToDisplay","tbodyContents","numRowsPassedAfterStartIndex","colspan","colSpan","placeholderText","rowCSS","noMatchesText","componentWillLoad","componentId","paginationComponentElement","paginationId","headerCells","firstPaginationOption","peekNumber","textContent","hasAttribute","isNaN","setAttribute","componentWillRender","recordsOnThisPage","render","tableClass","map","componentDidRender","records","componentDidLoad"],"sources":["src/components/yeti-table/yeti-table.tsx"],"sourcesContent":["import { Component, Prop, h, State, Watch, Element, Event, EventEmitter, Listen } from '@stencil/core';\r\nimport { utils, YetiTableContents, YetiTableRow, YetiTableCell } from '../../utils/utils';\r\nimport { YetiDatePicker } from '../yeti-date-picker/yeti-date-picker';\r\nimport { YetiMultiselect } from '../yeti-multiselect/yeti-multiselect';\r\nimport { YetiTablePagination } from '../yeti-table-pagination/yeti-table-pagination';\r\n\r\n@Component({\r\n  tag: 'yeti-table',\r\n  shadow: false,\r\n})\r\n\r\nexport class YetiTable {\r\n\r\n  @Element() el: HTMLElement;\r\n\r\n  /**\r\n   * Fires when user chooses an option from the optional Menu Button component.\r\n   */\r\n  @Event({ bubbles: true }) rowActionClick: EventEmitter;\r\n\r\n  /**\r\n   * Fires when an isRadio cell changes value.\r\n   */\r\n  @Event({ bubbles: true }) cellRadioChange: EventEmitter;\r\n\r\n  /**\r\n   * Fires when user clicks a sortable header. This only fires when sortSelf is false (i.e. some logic outside the component will handle sorting and presumably update the table's contents).\r\n   */\r\n  @Event({ bubbles: true }) tableSort: EventEmitter;\r\n\r\n  /**\r\n   * Fires when user updates a column filter. This only fires when filterSelf is false (i.e. some logic outside the component will handle filtering and presumably update the table's contents).\r\n   */\r\n  @Event({ bubbles: true }) tableFilter: EventEmitter;\r\n\r\n  /**\r\n   * Fires when user chooses a different page of data. This only fires when paginateSelf is false (i.e. some logic outside the component will handle pagination and presumably update the table's contents).\r\n   */\r\n  @Event({ bubbles: true }) tablePaginate: EventEmitter;\r\n\r\n  /**\r\n   * CSS classlist that will be added to the actual html table element.\r\n   */\r\n  @Prop() tableClass: string = '';\r\n\r\n  /**\r\n   * id that will be assigned to the actual html table element.\r\n   */\r\n  @Prop() tableId: string = utils.generateUniqueId();\r\n\r\n  /**\r\n   * Placeholder text when filtering returns no matching records.\r\n   */\r\n  @Prop() noRecordsText: string = \"No records\";\r\n\r\n  /**\r\n   * Placeholder text when filtering returns no matching records.\r\n   */\r\n  @Prop() noMatchesText: string = \"No records found matching your filter criteria\";\r\n\r\n  /**\r\n   * Number of table records\r\n   */\r\n  @Prop() records?: number = 0;\r\n\r\n  /**\r\n   * Unique type that captures the table's contents and configurable state information. See utils.ts for details.\r\n   */\r\n  @Prop() contents: YetiTableContents = {\r\n    head: {\r\n      rows: []\r\n    },\r\n    body: {\r\n      rows: []\r\n    }\r\n  }\r\n\r\n  @Watch('contents')\r\n  watchContentsHandler(newValue: YetiTableContents, oldValue: YetiTableContents) {\r\n\r\n    if (!newValue.body) {\r\n      console.error('Supplied data has no table body.');\r\n      return false;\r\n    } else if (!newValue.body.rows) {\r\n      console.error('Supplied data must have rows in table body.');\r\n      return false;\r\n    }\r\n\r\n    this.markRowsWithChangedRowActions(oldValue);\r\n\r\n    // See if the headings changed\r\n    if (newValue.head && oldValue.head && newValue.head != oldValue.head) {\r\n      this.setHeadingColumnIndices();\r\n      //this.setDefaultFilterValues();\r\n    }\r\n\r\n    // See if the body changed\r\n    if (newValue.body && oldValue.body && newValue.body != oldValue.body) {\r\n      this.setBodyColumnIndices();\r\n      //this.setDefaultFilterValues();\r\n    }\r\n\r\n  }\r\n\r\n  /**\r\n   * Determines whether to handle sorting (true) or just note the user requested it (false).\r\n   */\r\n  @Prop() sortSelf: boolean = true;\r\n\r\n  /**\r\n   * Determines whether to handle filtering (true) or just note the user requested it (false).\r\n   */\r\n  @Prop() filterSelf: boolean = true;\r\n\r\n  /**\r\n   * Determines whether to handle pagination (true) or just note the user requested it (false).\r\n   */\r\n  @Prop() paginateSelf: boolean = true;\r\n\r\n  /**\r\n   * Text that will be displayed in the table body when contents.body is empty.\r\n   */\r\n  @Prop() placeholderText: string = \"\";\r\n\r\n  /**\r\n   * Toggle this to force a re-render of the whole component.\r\n   */\r\n  @State() iLoveJSX: boolean = true;\r\n\r\n  /**\r\n   * Index of the first table record to display (used when paging).\r\n   */\r\n  @State() firstRecordIndexToDisplay: number = 0;\r\n\r\n  /**\r\n   * How many records to display at one time (used when paging).\r\n   */\r\n  @State() numRecordsToDisplay: number = 0; // Will initialize on load\r\n\r\n  /**\r\n   * Reference to an associated Pagination component, if it exists. This will be auto-set when the component first loads.\r\n   */\r\n  @State() paginationComponent: YetiTablePagination = null;\r\n\r\n  /**\r\n   * Tracks whether the user has requested filtering on any column. Primarily used to determine whether to show the clear filters icon.\r\n   */\r\n  @State() filtersAreActive: boolean = false;\r\n\r\n  private tableHasFilters: boolean = false;\r\n\r\n  private rowsThatPassFiltering: number = 0;\r\n\r\n  @Listen('paginationUpdated')\r\n  handlePaginationUpdate(ev) {\r\n    let paginator = ev.target;\r\n\r\n    this.numRecordsToDisplay = paginator.recordsDisplayed;\r\n\r\n    // Handle pagination ourselves\r\n    if (this.paginateSelf) {\r\n      this.firstRecordIndexToDisplay = paginator.startIndex;\r\n    }\r\n\r\n    // Let the component consumer handle pagination\r\n    else {\r\n      this.tablePaginate.emit({\r\n        \"currentPage\": ev.detail.currentPage,\r\n        \"recordsDisplayed\": ev.detail.recordsDisplayed\r\n      })\r\n    }\r\n  }\r\n\r\n  @Listen('readyToVerifySlow')\r\n  @Listen('readyToVerifyFast')\r\n  handleReadyToVerify(ev) {\r\n\r\n    let targetGeneric = ev.target as HTMLElement;\r\n    let columnIndex = parseInt(targetGeneric.getAttribute(\"data-column\"));\r\n\r\n    switch (targetGeneric.nodeName.toLowerCase()) {\r\n\r\n      case \"yeti-date-picker\":\r\n\r\n        let picker = ev.target as YetiDatePicker;\r\n        this.handleDateFilterChange(picker, columnIndex);\r\n        return;\r\n\r\n      case \"yeti-multiselect\":\r\n\r\n        let multiselect = ev.target as YetiMultiselect;\r\n\r\n        if (ev.type == 'readyToVerifyFast') {\r\n          this.handleMultiselectFilterChange(multiselect, columnIndex);\r\n        }\r\n        return;\r\n    }\r\n  }\r\n\r\n  @Listen('menuButtonChange')\r\n  handleMenuButtonChange(ev) {\r\n\r\n    let menuButton = ev.target;\r\n    let newValue = ev.detail.newValue;\r\n    let rowIndex = menuButton.getAttribute(\"data-row-index\");\r\n\r\n    this.rowActionClick.emit({\r\n      \"rowIndex\": rowIndex,\r\n      \"actionLabel\": newValue\r\n    });\r\n    \r\n  }\r\n\r\n\r\n\r\n  handleCellRadioChange(cell: YetiTableCell) {\r\n\r\n    let rows = this.contents.body.rows;\r\n    let row = rows[ cell.rowIndex ];\r\n\r\n    // Unselect the other rows\r\n    rows.forEach(row => row.isSelected = false);\r\n    row.isSelected = true;\r\n\r\n    this.iLoveJSX = !this.iLoveJSX;\r\n    \r\n    this.cellRadioChange.emit({\r\n      \"row\": row,\r\n      \"cell\": cell\r\n    });\r\n\r\n  }\r\n\r\n\r\n\r\n  setFiltersActiveFlag() {\r\n    if (!this.tableHasFilters) {\r\n      this.filtersAreActive = false;\r\n    } else {\r\n      // We know this table has filters. Loop through them all and see if any have a value other than \"\".\r\n\r\n      for (let i = 0; i < this.contents.head.rows[0].cells.length; i++) {\r\n        if (\r\n          this.contents.head.rows[0].cells[i].filtering \r\n          && this.contents.head.rows[0].cells[i].filtering.value != \"\"\r\n          && this.contents.head.rows[0].cells[i].filtering.value != undefined\r\n        ) {\r\n          this.filtersAreActive = true;\r\n          return;\r\n        }\r\n      }\r\n\r\n      this.filtersAreActive = false;\r\n    }\r\n  }\r\n\r\n\r\n\r\n  markRowsWithChangedRowActions(oldContents) {\r\n    /*\r\n      Stencil's JSX compiler won't update the row actions <yeti-menu-button> component when row actions are changed in this.contents\r\n      because it's passed by reference or something. As a result, we have to manually check to see if the row actions have changed,\r\n      and if so, give the <yeti-menu-button> a new key to trigger a rerender with the latest data.\r\n    */\r\n    if (!this.contents.body || !this.contents.body.rows || !this.contents.body.rows.length) {\r\n      return;\r\n    }\r\n\r\n    this.contents.body.rows.forEach((row, rowIndex) => {\r\n      row.cells.forEach((cell, cellIndex) => {\r\n        if (cell.rowActions && cell.rowActions.length && cell.rowActions.length > 0) {\r\n          if (oldContents.body && oldContents.body.rows && oldContents.body.rows[rowIndex] && oldContents.body.rows[rowIndex].cells[cellIndex] && !utils.isEqual(cell.rowActions, oldContents.body.rows[rowIndex].cells[cellIndex].rowActions)) {\r\n            \r\n            row.rowActionsJustChanged = true;\r\n\r\n          }\r\n        }\r\n      });\r\n    });\r\n  }\r\n\r\n\r\n\r\n  isValidTableData(data: object | string): boolean {\r\n    // Verify that the supplied data is in the correct format.\r\n    \r\n    if (utils.isValidJSON(data)) {\r\n      // The data is at least JSON\r\n      data = JSON.stringify(data);\r\n      data = JSON.parse(data);\r\n\r\n      return true;\r\n    } else {\r\n      console.error('Error in yeti-table; supplied data was not valid JSON.');\r\n    }\r\n\r\n    return true;\r\n  }\r\n\r\n\r\n\r\n  setHeadingColumnIndices() {\r\n    \r\n    // First check if there even is a head.\r\n    if (!this.contents.head || !this.contents.head.rows || !(this.contents.head.rows.length > 0)) {\r\n      return;\r\n    }\r\n\r\n    this.contents.head.rows.forEach((row, rowIndex) => {\r\n      row.rowIndex = rowIndex;\r\n\r\n      row.cells.forEach((cell, cellIndex) => {\r\n        cell.columnIndex = cellIndex;\r\n      })\r\n    })\r\n  }\r\n\r\n\r\n\r\n  setBodyColumnIndices() {\r\n    this.contents.body.rows.forEach((row, rowIndex) => {\r\n      row.rowIndex = rowIndex;\r\n\r\n      row.cells.forEach((cell, cellIndex) => {\r\n        cell.columnIndex = cellIndex;\r\n        cell.rowIndex = rowIndex;\r\n      })\r\n    })\r\n  }\r\n\r\n\r\n\r\n  setSortableOnCellsOtherThanTheOneWithThisIndex(columnIndex: number) {\r\n\r\n    let ths = this.contents.head.rows[0].cells;\r\n    \r\n    for (let i = 0, th = ths[0]; i < ths.length; i++, th = ths[i]) {\r\n    \r\n      if (th.sortDirection) {\r\n\r\n        th.sortDirection = (th.columnIndex == columnIndex) ? th.sortDirection : \"unsorted\"\r\n\r\n      }\r\n      \r\n    }\r\n  }\r\n\r\n\r\n\r\n  setDefaultFilterValues() {\r\n    if (!this.contents.head || !this.contents.head.rows || !(this.contents.head.rows.length > 0)) {\r\n      return;\r\n    }\r\n\r\n    this.contents.head.rows.forEach((row) => {\r\n      row.cells.forEach((cell) => {\r\n        if (cell.filtering) {\r\n          cell.filtering.value = \"\";\r\n        }\r\n      })\r\n    });\r\n    \r\n    this.filtersAreActive = false;\r\n  }\r\n\r\n\r\n  \r\n  handleSort(ev: Event, cell: YetiTableCell) {\r\n\r\n    ev.preventDefault();\r\n\r\n    // First check to see if we're doing this ourselves\r\n    if (!this.sortSelf) {\r\n\r\n      // We don't have to sort this ourselves.\r\n      this.tableSort.emit({\r\n        \"columnIndex\": cell.columnIndex,\r\n        \"sortDirection\": (cell.sortDirection == \"ascending\") ? \"descending\" : \"ascending\"\r\n      });\r\n\r\n      return;\r\n    }\r\n    \r\n    // We need to sort this ourselves\r\n    cell.sortDirection = (cell.sortDirection == \"ascending\") ? \"descending\" : \"ascending\";\r\n    this.sortContentsPerHeaderCell(cell);\r\n    this.iLoveJSX = !this.iLoveJSX; // this.render() doesn't work, and there's no this.forceUpdate() in Stencil\r\n\r\n  }\r\n\r\n\r\n\r\n  sortContentsPerHeaderCell(cell: YetiTableCell) {\r\n    this.contents.body.rows.sort((a: YetiTableRow, b: YetiTableRow) => {\r\n\r\n      // Get values to sort on.\r\n      let aValue: string = a.cells[cell.columnIndex].value;\r\n      let bValue: string = b.cells[cell.columnIndex].value;\r\n\r\n      // Determine the types of each value.\r\n      let aType = utils.getStringifiedType(aValue);\r\n      let bType = utils.getStringifiedType(bValue);\r\n\r\n      // Adjust for sort direction.\r\n      let sortModifier = (cell.sortDirection == \"ascending\") ? 1 : -1; // Always sort ascending unless we already are.\r\n\r\n      // Handle mismatched types, first.\r\n      if (aType != bType) {\r\n\r\n        if (sortModifier > 0) {\r\n\r\n          // Sort ascending order: numbers, strings, dates.\r\n          switch (aType) {\r\n            case \"number\": return -1;\r\n            case \"string\": return -1;\r\n            default: return 1;\r\n          }\r\n\r\n        } else {\r\n\r\n          // Sort descending order: dates, strings, numbers.\r\n          switch (aType) {\r\n            case \"date\": return -1;\r\n            case \"string\": return -1;\r\n            default: return 1;\r\n          }\r\n\r\n        }\r\n\r\n      }\r\n\r\n      // Handle matched types\r\n      switch (aType) {\r\n\r\n        case \"number\": {\r\n          return (utils.castToNumber(aValue) - utils.castToNumber(bValue)) * sortModifier;\r\n        }\r\n\r\n        case \"string\": {\r\n          if (aValue == bValue) {\r\n            return 0;\r\n          } else {\r\n            return (aValue.toLowerCase() < bValue.toLowerCase()) ? (-1 * sortModifier) : (1 * sortModifier);\r\n          }\r\n        }\r\n\r\n        case \"date\": {\r\n          let aDate: Date = new Date(aValue);\r\n          let bDate: Date = new Date(bValue);\r\n          if (aDate == bDate) {\r\n            return 0;\r\n          } else {\r\n            return (aDate < bDate) ? (-1 * sortModifier) : (1 * sortModifier);\r\n          }\r\n        }\r\n      }\r\n\r\n    });\r\n\r\n    this.setSortableOnCellsOtherThanTheOneWithThisIndex(cell.columnIndex);\r\n  }\r\n\r\n\r\n\r\n  handleTextFilterChange(e: KeyboardEvent, input: HTMLInputElement, columnIndex: number) {\r\n\r\n    // We're only interested in the enter key.\r\n    if (e.key != \"Enter\") {\r\n      e.preventDefault();\r\n      e.stopImmediatePropagation();\r\n      return false;\r\n    }\r\n    \r\n    // It was enter, so start searching\r\n    this.handleTextFilterSearch(input, columnIndex);\r\n\r\n  }\r\n\r\n\r\n\r\n  handleTextFilterSearch(input: HTMLInputElement, columnIndex: number) {\r\n    // First, make sure we're supposed to do this ourselves\r\n    if (!this.filterSelf) {\r\n\r\n      // Reset pagination current page to 0;\r\n      this.paginationComponent.selectedPage = 1;\r\n\r\n      this.tableFilter.emit({\r\n        \"columnIndex\": columnIndex,\r\n        \"value\": input.value\r\n      });\r\n    }\r\n\r\n    // Yep, it's our job.\r\n    else {\r\n      this.contents.head.rows[0].cells[columnIndex].filtering.value = input.value;\r\n      this.iLoveJSX = !this.iLoveJSX;\r\n    }\r\n\r\n    this.setFiltersActiveFlag();\r\n  }\r\n\r\n\r\n\r\n  handleTextFilterButtonClick(e, input: HTMLInputElement, columnIndex: number) {\r\n    e.preventDefault();\r\n    this.handleTextFilterSearch(input, columnIndex);\r\n  }\r\n\r\n\r\n\r\n  handleTextFilterClear(input, columnIndex) {\r\n    input.value = \"\"; // There may be some lag in updating this from the component side; this is to be sure.\r\n    this.handleTextFilterSearch(input, columnIndex);\r\n  }\r\n\r\n\r\n\r\n  handleSelectFilterChange(select: HTMLSelectElement, columnIndex: number) {\r\n\r\n    // First make sure we're supposed to do this ourselves\r\n    if (!this.filterSelf) {\r\n\r\n      // Reset pagination current page to 0;\r\n      this.paginationComponent.selectedPage = 1;\r\n\r\n      this.tableFilter.emit({\r\n        \"columnIndex\": columnIndex,\r\n        \"value\": select.value\r\n      });\r\n    }\r\n\r\n    // Yep, it's our job.\r\n    else {\r\n      this.contents.head.rows[0].cells[columnIndex].filtering.value = (select.selectedIndex == 0) ? \"\" : select.value;\r\n      this.iLoveJSX = !this.iLoveJSX;\r\n    }\r\n\r\n    this.setFiltersActiveFlag();\r\n    \r\n  }\r\n\r\n\r\n\r\n  handleDateFilterChange(picker: YetiDatePicker, columnIndex: number) {\r\n\r\n    // First make sure we're supposed to do this ourselves\r\n    if (!this.filterSelf) {\r\n\r\n      // Reset pagination current page to 0;\r\n      this.paginationComponent.selectedPage = 1;\r\n\r\n      this.tableFilter.emit({\r\n        \"columnIndex\": columnIndex,\r\n        \"value\": picker.value,\r\n        \"isValid\": picker.isValid,\r\n        \"control\": picker\r\n      });\r\n    }\r\n\r\n    // Yep, it's our job.\r\n    else {\r\n      this.contents.head.rows[0].cells[columnIndex].filtering.value = picker.value;\r\n      this.iLoveJSX = !this.iLoveJSX;\r\n    }\r\n\r\n    this.setFiltersActiveFlag();\r\n    \r\n  }\r\n\r\n\r\n\r\n  handleMultiselectFilterChange(multiselect: YetiMultiselect, columnIndex: number) {\r\n\r\n    // First make sure we're supposed to do this ourselves\r\n    if (!this.filterSelf) {\r\n\r\n      // Reset pagination current page to 0;\r\n      this.paginationComponent.selectedPage = 1;\r\n\r\n      this.tableFilter.emit({\r\n        \"columnIndex\": columnIndex,\r\n        \"value\": multiselect.value\r\n      });\r\n    }\r\n\r\n    // Yep, it's our job.\r\n    else {\r\n      this.contents.head.rows[0].cells[columnIndex].filtering.value = multiselect.value;\r\n      this.iLoveJSX = !this.iLoveJSX;\r\n    }\r\n    \r\n    this.setFiltersActiveFlag();\r\n    \r\n  }\r\n\r\n\r\n\r\n  handleClearAllFilters() {\r\n    \r\n    // First make sure we're supposed to do this ourselves\r\n    if (!this.filterSelf) {\r\n\r\n      // Reset pagination current page to 0;\r\n      this.paginationComponent.selectedPage = 1;\r\n\r\n      this.tableFilter.emit({\r\n        \"columnIndex\": -1,\r\n        \"value\": \"clear\"\r\n      });\r\n    }\r\n\r\n    // Yep, it's our job.\r\n    else {\r\n      this.iLoveJSX = !this.iLoveJSX;\r\n    }\r\n\r\n    this.setDefaultFilterValues();\r\n\r\n  }\r\n\r\n\r\n\r\n  doesRowPassFiltering(row: YetiTableRow) {\r\n    // Checks to see if this row should be filtered out or if it's safe to show. Returns true or false.\r\n    if (!this.filterSelf) {\r\n      // If we're not filtering ourselves then pass automatically.\r\n      return true;\r\n    }\r\n\r\n    // Check to see if each cell in the row passes filtering.\r\n    for (let i=0; i<row.cells.length; i++) {\r\n      if (!this.doesCellPassFiltering(row.cells[i])) {\r\n        //console.error(`row ${row.rowIndex} failed filtering because of cell ${row.cells[i].value}`)\r\n        return false;\r\n      }\r\n    }\r\n\r\n    return true;\r\n  }\r\n\r\n\r\n\r\n  doesCellPassFiltering(cell: YetiTableCell) {\r\n    // Checks to see if this cell matches its heading's filters (if they exist).\r\n\r\n    if (cell.value == \"undefined\") {\r\n      cell.value = \"\";\r\n    }\r\n\r\n    // Row heading only tables can't have filtering, so pass them.\r\n    if (!this.contents.head || !this.contents.head.rows || !(this.contents.head.rows.length > 0)) {\r\n      return true;\r\n    }\r\n\r\n    let th = this.contents.head.rows[0].cells[cell.columnIndex];\r\n\r\n    // First see if filtering is even a thing for this column. If it isn't, we're good.\r\n    if (th && th.filtering && th.filtering.isFilterable && th.filtering.value) {\r\n      \r\n      let filterValue = th.filtering.value;\r\n\r\n      // It depends on what type of filter (text, select, date, or multiselect) it is.\r\n      switch (th.filtering.type) {\r\n\r\n        case \"text\": {\r\n\r\n          if (cell.value.indexOf(filterValue) >= 0) {\r\n            return true;\r\n          } else {\r\n            return false;\r\n          }\r\n        }\r\n\r\n\r\n        case \"select\": {\r\n\r\n          if (cell.value.indexOf(filterValue) >= 0 || filterValue == \"\") {\r\n            return true;\r\n          } else {\r\n            return false;\r\n          }\r\n        }\r\n\r\n\r\n        case \"date\": {\r\n          \r\n          if (filterValue == \"\") {\r\n            return true;\r\n          } else if (new Date(filterValue).getTime() == new Date(cell.value).getTime()) {\r\n            return true;\r\n          } else {\r\n            return false;\r\n          }\r\n        }\r\n\r\n\r\n        case \"multiselect\": {\r\n\r\n          // First, see if there are no values selected at all, in which case we pass.\r\n          if (filterValue == \"\") {\r\n            return true;\r\n\r\n          // Second, see if the cell's value is in the array.\r\n          } else {\r\n            let filterValuesArray = filterValue.split(\",\");\r\n            return filterValuesArray.includes(cell.value);\r\n          }\r\n\r\n        }\r\n\r\n\r\n        default:\r\n          console.error(\"Error in table data: unexpected filtering type supplied.\")\r\n          return false;\r\n      }\r\n\r\n    // There's no filtering, so it passes by default.\r\n    } else {\r\n      return true;\r\n    }\r\n\r\n  }\r\n\r\n\r\n\r\n  getNumberOfRecords() {\r\n    return (this.contents.body && this.contents.body.rows && this.contents.body.rows.length) ? this.contents.body.rows.length : -1;\r\n  }\r\n\r\n\r\n\r\n  renderCell(cell: YetiTableCell) {\r\n\r\n    if (!cell.id || cell.id == \"\") {\r\n      //console.warn(\"Each table cell should have a unique id.\");\r\n      cell.id = utils.generateUniqueId();\r\n    }\r\n\r\n    // See if it's a filter clear cell\r\n    if (cell.filtering && cell.filtering.isClearCell) {\r\n\r\n      this.tableHasFilters = true;\r\n\r\n      return this.renderFilterClearCell(cell);\r\n\r\n    }\r\n\r\n    // See if it's a row actions cell\r\n    if (cell.rowActions) {\r\n\r\n      return this.renderRowActionsCell(cell);\r\n\r\n    }\r\n\r\n    // See if it's a radio cell\r\n    if (cell.isRadio) {\r\n\r\n      return this.renderRadioCell(cell);\r\n\r\n    }\r\n\r\n    // See if it's a th\r\n    if (cell.isHeading) {\r\n\r\n      return this.renderTableHeading(cell);\r\n\r\n    // It must be a td\r\n    } else {\r\n\r\n      let css = (cell.cssClass && cell.cssClass != '') ? ' ' + cell.cssClass : '';\r\n\r\n      if (cell.template) {\r\n        return <td class={'yeti-table-cell' + css} id={cell.id} key={cell.id} innerHTML={cell.template}></td>\r\n      }\r\n\r\n      return <td class={'yeti-table-cell' + css} id={cell.id} key={cell.id}>{cell.value}</td>\r\n\r\n    }\r\n\r\n  }\r\n\r\n\r\n\r\n  renderRowActionsCell(cell: YetiTableCell) {\r\n\r\n    let css = (cell.cssClass && cell.cssClass != \"\") ? \r\n      \"yeti-table-cell yeti-table-control yeti-table-cell-row_actions\" + cell.cssClass : \r\n      \"yeti-table-cell yeti-table-control yeti-table-cell-row_actions\";\r\n\r\n    let preexistingMenuButtonElement = document.querySelector(`#${cell.id} yeti-menu-button`);\r\n\r\n    let controlId;\r\n    let control;\r\n    let timesUpdated;\r\n\r\n    // Initialize controlId\r\n    if (preexistingMenuButtonElement && preexistingMenuButtonElement.getAttribute(\"id\")) {\r\n      controlId = preexistingMenuButtonElement.getAttribute(\"id\");\r\n    } else {\r\n      controlId = (cell.id && cell.id !== \"\") ? `${cell.id}_menuButton` : utils.generateUniqueId();\r\n    }\r\n\r\n    // Initialize timesUpdated\r\n    if (preexistingMenuButtonElement && preexistingMenuButtonElement.getAttribute(\"data-times-updated\")) {\r\n      timesUpdated = parseInt( preexistingMenuButtonElement.getAttribute(\"data-times-updated\"));\r\n    } else {\r\n      timesUpdated = 0;\r\n    }\r\n\r\n    // Handle the case where the row actions have changed.\r\n    if (this.contents.body.rows[cell.rowIndex].rowActionsJustChanged) {\r\n      \r\n      // If the menu button has been changed previously then it'll have an attribute of data-times-updated\r\n      ++timesUpdated;\r\n\r\n      controlId = (cell.id && cell.id !== \"\") ? `${cell.id}_menuButton_mk${timesUpdated}` : utils.generateUniqueId();\r\n      this.contents.body.rows[cell.rowIndex].rowActionsJustChanged = false;\r\n    \r\n    }\r\n\r\n    // Handle the case where there are no actions for this row.\r\n    if (cell.rowActions.length <= 0) {\r\n      return <td class={css} id={cell.id} key={cell.id}></td>\r\n    }\r\n\r\n    // Otherwise there are actions for this row.\r\n    else {\r\n      let actions = [];\r\n\r\n      for (let i = 0; i < cell.rowActions.length; i++) {\r\n\r\n        let action;\r\n        let actionId = `${controlId}_opt${i}`;\r\n\r\n        if (cell.rowActions[i].href) {\r\n          action = <yeti-menu-button-option href={cell.rowActions[i].href} id={actionId} key={actionId}>{cell.rowActions[i].label}</yeti-menu-button-option>\r\n        } else {\r\n          action = <yeti-menu-button-option id={actionId} key={actionId}>{cell.rowActions[i].label}</yeti-menu-button-option>\r\n        }\r\n\r\n        actions.push(action);\r\n      }\r\n\r\n      control = <yeti-menu-button \r\n        menu-alignment=\"right\" \r\n        data-row-index={cell.rowIndex} \r\n        data-times-updated={`${timesUpdated}`}\r\n        id={controlId}\r\n        key={controlId}\r\n        tooltipText=\"Row actions\">{actions}</yeti-menu-button>\r\n\r\n      return <td class={css} id={cell.id} key={cell.id}>{control}</td>\r\n      \r\n    }\r\n  }\r\n\r\n\r\n\r\n  renderRadioCell(cell: YetiTableCell) {\r\n\r\n    let css = (cell.cssClass && cell.cssClass != \"\") ? \r\n      \" \" + cell.cssClass : \r\n      \"\";\r\n\r\n    let radioName = `${this.tableId}_radios`;\r\n    let radioValue = `${radioName}_${cell.rowIndex}`;\r\n    let row = this.contents.body.rows[cell.rowIndex];\r\n    let isRowChecked = (row.isSelected) ? true : false;\r\n\r\n    let control = <input \r\n      type=\"radio\" \r\n      class=\"yeti-radio\" \r\n      name={radioName} \r\n      value={radioValue} \r\n      id={radioValue} \r\n      onChange={() => {\r\n        this.handleCellRadioChange(cell);\r\n      }}\r\n      {...(isRowChecked ? {\"checked\": true} : {})} \r\n    />;\r\n\r\n    return <td class={`yeti-table-cell yeti-table-control ${css}`} id={cell.id} key={cell.id}>{control}</td>\r\n    \r\n  }\r\n\r\n\r\n\r\n  renderFilterClearCell(cell: YetiTableCell) {\r\n\r\n    let css = (cell.cssClass && cell.cssClass != \"\") ? \r\n      \" \" + cell.cssClass : \r\n      \"\";\r\n\r\n    let control = <yeti-tooltip text=\"Clear filters\">\r\n      <button \r\n        class=\"yeti-table-filter-clear-button\" \r\n        onClick={(ev) => { this.handleClearAllFilters(); ev.preventDefault(); }} \r\n        aria-label=\"Clear all filters\">\r\n        \r\n        <span class=\"material-icons\" aria-hidden=\"true\">cancel</span>\r\n        \r\n      </button>\r\n    </yeti-tooltip>\r\n\r\n    return <td class={`yeti-table-heading yeti-table-cell-clear ${css}`} id={cell.id} key={cell.id}>{(this.filtersAreActive) ? control : \"\"}</td>\r\n      \r\n  }\r\n\r\n\r\n\r\n  renderTableHeading(cell: YetiTableCell) {\r\n\r\n    let css = (cell.cssClass && cell.cssClass != '') ? ' ' + cell.cssClass : '';\r\n\r\n    // First double-check it's a th\r\n    if (!cell.isHeading) {\r\n\r\n      console.error(\"Error rendering table cell: expected th, got td.\");\r\n      return;\r\n\r\n    // It's a th\r\n    } else {\r\n\r\n      let headingLabelId;\r\n\r\n      if (!cell.id || cell.id == \"\") {\r\n        //console.warn(\"Table cells with filtering require a unique id.\");\r\n        headingLabelId = utils.generateUniqueId();\r\n      } else {\r\n        headingLabelId = `${cell.id}_heading`;\r\n      }\r\n\r\n      // It's a th, see if it's sortable or not.\r\n      if (cell.sortDirection) {\r\n\r\n        // It's a sortable column heading.\r\n        let sortableHeading: YetiTableCell;\r\n        let filter = \"\";\r\n        let a11yText: string;\r\n        let iconKey: string;\r\n\r\n        cell.sortDirection = cell.sortDirection.toLowerCase();\r\n\r\n        switch (cell.sortDirection) {\r\n\r\n          case \"ascending\":\r\n\r\n            a11yText = \"Sorted ascending\";\r\n            iconKey = \"expand_less\"\r\n            break;\r\n\r\n\r\n          case \"descending\":\r\n\r\n            a11yText = \"Sorted descending\";\r\n            iconKey = \"expand_more\"\r\n            break;\r\n            \r\n\r\n          default:\r\n\r\n            a11yText = \"Sortable\";\r\n            iconKey = \"unfold_more\";\r\n      \r\n        }\r\n\r\n        // See if it's sortable and filterable\r\n        if (cell.filtering && cell.filtering.isFilterable) {\r\n          filter =\r\n          <div class=\"yeti-table-heading-filter\">\r\n            {this.renderTableHeadingFilter(cell, headingLabelId)}\r\n          </div>\r\n        }\r\n\r\n        sortableHeading =\r\n          <th class={`yeti-table-heading ${css}`} scope={(cell.scope && cell.scope == \"row\") ? \"row\" : \"col\"}>\r\n\r\n            <div class=\"yeti-table-heading-compound\">\r\n\r\n                <button class=\"yeti-table-heading-button\" onClick={(ev) => { this.handleSort(ev, cell) }}>\r\n\r\n                    <div class=\"yeti-table-heading-button-label\" id={headingLabelId}>{cell.value}</div>\r\n\r\n                    <span class=\"yeti-table-heading-button-icon\">\r\n                        <span class=\"yeti-a11y-hidden\">{a11yText}</span>\r\n                        <span class=\"material-icons\" aria-hidden=\"true\" title={a11yText}>{iconKey}</span>\r\n                    </span>\r\n\r\n                </button>\r\n\r\n                { filter ? filter : \"\" }\r\n\r\n            </div>\r\n\r\n          </th>\r\n\r\n        return sortableHeading;\r\n\r\n      // See if it's filterable but not sortable.\r\n      } else if (cell.filtering && cell.filtering.isFilterable) {\r\n\r\n        return <th class={'yeti-table-heading' + css} scope={(cell.scope && cell.scope == \"row\") ? \"row\" : \"col\"}>\r\n\r\n          <div class=\"yeti-table-heading-compound\">\r\n\r\n            <div class=\"yeti-table-heading-compound-actual\" id={headingLabelId}>{cell.value}</div>\r\n\r\n\r\n            <div class=\"yeti-table-heading-filter\">\r\n              \r\n              {this.renderTableHeadingFilter(cell, headingLabelId)}\r\n\r\n            </div>\r\n\r\n          </div>\r\n\r\n        </th>\r\n\r\n      // It must be a simple column heading.\r\n      } else {\r\n\r\n        // It's a simple column heading.\r\n        return <th class={'yeti-table-heading' + css} scope={(cell.scope && cell.scope == \"row\") ? \"row\" : \"col\"}>{cell.value}</th>\r\n\r\n      }\r\n\r\n    }\r\n  }\r\n\r\n\r\n  \r\n  renderTableHeadingFilter(cell: YetiTableCell, headingLabelId: string) {\r\n    // Returns the JSX for the appropriate filter object (text, select, date picker, or multiselect)\r\n\r\n    let filterId = `${cell.id}_filter`;\r\n\r\n    switch (cell.filtering.type) {\r\n\r\n      case \"text\":\r\n\r\n        let inputIdString = `yeti-table-filter-text-${cell.columnIndex}`;\r\n\r\n        return <div class=\"yeti-table-heading-filter-input-wrapper\">\r\n        \r\n          {/* <input \r\n            type=\"text\" \r\n            value={cell.filtering.value}\r\n            class=\"yeti-input yeti-table-heading-filter-input\" \r\n            onKeyUp={(ev) => {\r\n              let that = ev.target as HTMLInputElement;\r\n              this.handleTextFilterChange(that, cell.columnIndex);\r\n            }}\r\n            aria-labelledby={headingLabelId} /> */}\r\n\r\n          <yeti-input\r\n            type=\"search\"\r\n            value={cell.filtering.value}\r\n            inputClass='yeti-table-heading-filter-input'\r\n            onKeyUp={(ev) => {\r\n              let that = ev.target as HTMLInputElement;\r\n              this.handleTextFilterChange(ev, that, cell.columnIndex);\r\n            }}\r\n            onSearchFieldClear={() => this.handleTextFilterClear(this.el.querySelector(`#${inputIdString}`), cell.columnIndex)}\r\n            inputId={inputIdString}\r\n            labeledBy={headingLabelId}\r\n          ></yeti-input>\r\n\r\n          <button class=\"yeti-table-heading-filter-input-button\" onClick={(ev) => {\r\n            ev.preventDefault();\r\n            this.handleTextFilterButtonClick(ev, this.el.querySelector(`#${inputIdString}`), cell.columnIndex);\r\n          }}><span class=\"material-icons\" aria-hidden=\"true\">search</span></button>\r\n          \r\n        </div>\r\n\r\n\r\n      case \"select\":\r\n\r\n        let selectOptions = [];\r\n\r\n        // See if the multiselect options are supplied (they must be)\r\n        if (cell.filtering.options && cell.filtering.options.length > 0) {\r\n\r\n          for (let i = 0; i < cell.filtering.options.length; i++) {\r\n\r\n            // Set selected state based on the filtering value\r\n            // First handle the case where the filtering value is empty (default).\r\n            let selected = (i == 0 && cell.filtering.value == \"\") ? true : false;\r\n            let optionId = `${filterId}_option${i}`;\r\n\r\n            // Second handle the case where the filtering value matches this label.\r\n            selected = (cell.filtering.options[i] == cell.filtering.value) ? true : false;\r\n\r\n            selectOptions.push(\r\n              <option selected={selected} id={optionId} key={optionId}>{cell.filtering.options[i]}</option>\r\n            )\r\n          }\r\n\r\n        // Contents doesn't have options specified, but they're required. Error out.\r\n        } else {\r\n\r\n          console.error(\"Error in table select filter: no options supplied.\");\r\n          return false;\r\n\r\n        }\r\n\r\n        return <select \r\n          class=\"yeti-select yeti-table-heading-filter-input\" \r\n          onChange={(ev) => {\r\n            this.handleSelectFilterChange(ev.target as HTMLSelectElement, cell.columnIndex);\r\n          }}\r\n          aria-labelledby={headingLabelId}>\r\n            <option value=\"\" id={`${filterId}_defaultOption`} key={`${filterId}_defaultOption`}>- Any -</option>\r\n            {selectOptions}\r\n          </select>;\r\n\r\n\r\n      case \"date\":\r\n\r\n        return <yeti-date-picker \r\n          data-column={cell.columnIndex} \r\n          labelled-by={headingLabelId} \r\n          value={cell.filtering.value}\r\n          id={filterId}\r\n          key={filterId}\r\n          showErrorTooltip={true}\r\n        ></yeti-date-picker>;\r\n\r\n\r\n      case \"multiselect\":\r\n\r\n        let multiselectOptions = [];\r\n\r\n        // See if the multiselect options are supplied (they must be)\r\n        if (cell.filtering.options && cell.filtering.options.length > 0) {\r\n\r\n          for (let i = 0; i < cell.filtering.options.length; i++) {\r\n            \r\n            let optionId = `${filterId}_option${i}`;\r\n            let optionLabel = cell.filtering.options[i];\r\n\r\n            let optionIsSelected = (cell.filtering.value && cell.filtering.value.includes(optionLabel)) ? true : false;\r\n\r\n            let optionProperties = {\r\n              id: optionId,\r\n              key: optionId\r\n            }\r\n\r\n            if (optionIsSelected) {\r\n              optionProperties[\"selected\"] = true;\r\n            }\r\n\r\n            multiselectOptions.push(\r\n              <yeti-multiselect-option {...optionProperties}>{optionLabel}</yeti-multiselect-option>\r\n            )\r\n\r\n          }\r\n\r\n        // Contents doesn't have options specified, but they're required. Error out.\r\n        } else {\r\n\r\n          console.error(\"Error in table multiselect filter: no options supplied.\");\r\n          return false;\r\n\r\n        }\r\n\r\n        return <yeti-multiselect \r\n            placeholder=\"- Any -\" \r\n            data-column={cell.columnIndex}\r\n            labelled-by={headingLabelId}\r\n            id={filterId}\r\n            key={filterId}\r\n            value={cell.filtering.value}>\r\n                {multiselectOptions}\r\n          </yeti-multiselect>\r\n\r\n\r\n      default:\r\n        console.error(\"Error rendering table filter: unexpected filtering type requested:\", cell.filtering.type);\r\n        return \"\";\r\n\r\n    }\r\n  }\r\n\r\n\r\n\r\n  renderRow(row: YetiTableRow) {\r\n\r\n    let cells = [];\r\n\r\n    row.cells.forEach((cell: YetiTableCell) => {\r\n      cells.push(this.renderCell(cell));\r\n    })\r\n\r\n    return cells;\r\n\r\n  }\r\n\r\n\r\n\r\n  renderHeaderRow(row: YetiTableRow) {\r\n    \r\n    // Basically the same as renderRow but first checks to see if we need to create a placeholder heading cell.\r\n    if (this.contents.head.rows.length == 0 || !this.contents.head.rows[0].cells || this.contents.head.rows[0].cells.length == 0) {\r\n\r\n      //console.warn(\"All tables should have headers.\");\r\n\r\n      return <th class=\"yeti-table-heading\" scope=\"col\">No data</th>\r\n    }\r\n\r\n    // Base case, just render the row as usual.\r\n    else {\r\n      return this.renderRow(row);\r\n    }\r\n  }\r\n\r\n\r\n\r\n  renderRows(rowStartIndex: number = 0, rowsToDisplay: number = this.contents.body.rows.length) {\r\n\r\n    let tbodyContents = [];\r\n    let rowsThatPassFiltering = [];\r\n    let numRowsPassedAfterStartIndex = 0;\r\n\r\n    // First make sure there are actual records to render.\r\n    if (this.contents.body.rows.length == 0 || !this.contents.body.rows[0].cells || this.contents.body.rows[0].cells.length == 0) {\r\n\r\n      // There are no records, display a placeholder row.\r\n      let colspan = (!this.contents.head.rows[0] || !this.contents.head.rows[0].cells) ? 1 : this.contents.head.rows[0].cells.length;\r\n      \r\n      return <tr class=\"yeti-table-body-row\">\r\n        <td class=\"yeti-table-cell\" colSpan={colspan}>{this.placeholderText}</td>\r\n      </tr>\r\n    }\r\n\r\n    for (let i = 0; i < this.contents.body.rows.length; i++) {\r\n\r\n      const row = this.contents.body.rows[i];\r\n      let rowCSS = \"yeti-table-body-row\";\r\n      rowCSS += (row.isSelected) ? \" yeti-table-body-row__selected\" : \"\";\r\n\r\n      if (this.doesRowPassFiltering(row)) {\r\n\r\n        rowsThatPassFiltering.push(row);\r\n\r\n        // row passes filtering. If...\r\n        if (\r\n          (i >= rowStartIndex) &&                           // This row is on or after the startIndex,...\r\n          (numRowsPassedAfterStartIndex < rowsToDisplay) && // ...and we haven't already found enough rows to display,...\r\n          (rowsThatPassFiltering.length >= rowStartIndex)   // ...and it's not one of the filtered rows short of our quota...\r\n        ) {\r\n        \r\n          if (!row.id || row.id == \"\") {\r\n            //console.warn(\"All table rows should have a unique id.\");\r\n            row.id = utils.generateUniqueId();\r\n          }\r\n\r\n          ++numRowsPassedAfterStartIndex;\r\n          tbodyContents.push( \r\n            <tr class={rowCSS} id={row.id} key={row.id}>{this.renderRow(row)}</tr>\r\n          );\r\n\r\n        }\r\n\r\n      }\r\n\r\n    }\r\n\r\n    this.rowsThatPassFiltering = rowsThatPassFiltering.length;\r\n\r\n    // If there's still at least one row to render...\r\n    if (tbodyContents.length > 0) {\r\n      \r\n      return tbodyContents;\r\n    \r\n    }\r\n\r\n    // Otherwise, render a placeholder row.\r\n    return <tr class={\"yeti-table-body-row\"}>\r\n      <td class=\"yeti-table-cell\" colSpan={this.contents.head.rows[0].cells.length}>{this.noMatchesText}</td>\r\n    </tr>;\r\n  }\r\n\r\n\r\n\r\n  componentWillLoad() {\r\n\r\n    let componentId = this.el.getAttribute(\"id\");\r\n    let paginationComponentElement = this.el.querySelector(\"yeti-table-pagination\");\r\n    let paginationId;\r\n    let headerCells;\r\n\r\n    // Initialize numRecordsToDisplay\r\n    if (paginationComponentElement) {\r\n      /*\r\n        Note: usually, we let the pagination component tell us what this.numRecordsToDisplay should be. However, on initial render,\r\n        when the pagination finishes rendering and notifies the table what numRecordsToDisplay should be the table is not yet done\r\n        rendering. Since numRecordsToDisplay is a state variable, this will trigger an immediate rerender. To avoid this, we cheat\r\n        a little by peaking at the un-parsed <yeti-table-pagination> tag. If it has <yeti-table-pagination-option>s, then we'll use\r\n        the value of the first one. If not, we'll use 10 (which is the pagination default).\r\n      */\r\n\r\n      let firstPaginationOption = paginationComponentElement.querySelector(\"yeti-table-pagination-option\");\r\n      let peekNumber = (firstPaginationOption) ? parseInt(firstPaginationOption.textContent) : 10;\r\n\r\n      if (firstPaginationOption) {\r\n        peekNumber = (firstPaginationOption.hasAttribute(\"all\")) ? this.getNumberOfRecords() : peekNumber;\r\n      }\r\n\r\n      this.numRecordsToDisplay = (!isNaN(peekNumber)) ? peekNumber : 10;\r\n\r\n      // At this point, even if this.numRecordsToDisplay is incorrect, the pagination component will correct it.\r\n\r\n    } else {\r\n\r\n      this.numRecordsToDisplay = this.getNumberOfRecords();\r\n\r\n    }\r\n\r\n    if (!componentId || componentId == \"\") {\r\n      componentId = utils.generateUniqueId();\r\n      this.el.setAttribute(\"id\", componentId);\r\n    }\r\n\r\n    this.setHeadingColumnIndices();\r\n    this.setBodyColumnIndices();\r\n    this.watchContentsHandler(this.contents, this.contents);\r\n\r\n    this.paginationComponent = this.el.querySelector(\"yeti-table-pagination\") as any;\r\n\r\n    if (paginationComponentElement) {\r\n      paginationId = paginationComponentElement.getAttribute(\"id\");\r\n      paginationId = (paginationId && paginationId !== \"\") ? paginationId : `${componentId}_pagination`;\r\n      paginationComponentElement.setAttribute(\"id\", paginationId);\r\n    }\r\n\r\n    // Sort contents if necessary\r\n    if (this.sortSelf) {\r\n\r\n      if (this.contents &&\r\n          this.contents.head &&\r\n          this.contents.head.rows &&\r\n          this.contents.head.rows[0] &&\r\n          this.contents.head.rows[0].cells) {\r\n            \r\n        headerCells = this.contents.head.rows[0].cells;\r\n\r\n        for (let i = 0; i < headerCells.length; i++) {\r\n          let cell = headerCells[i];\r\n          if (cell.sortDirection && (cell.sortDirection == \"ascending\" || cell.sortDirection == \"descending\")) {\r\n            this.sortContentsPerHeaderCell(cell);\r\n            break; // Only sort via the first one (since there should be only one of them anyway)\r\n          }\r\n        }\r\n      }\r\n\r\n    }\r\n\r\n  }\r\n\r\n\r\n\r\n  componentWillRender() {\r\n\r\n    let paginationComponentElement = this.el.querySelector(\"yeti-table-pagination\");\r\n\r\n    // If we're not paginating inside the component...\r\n    if (!this.paginateSelf) {\r\n\r\n      let recordsOnThisPage = this.paginationComponent.recordsDisplayed;\r\n\r\n      // ...then we need to handle the case where we're on the last page, and we don't need to show all the records we got back.\r\n      this.numRecordsToDisplay = recordsOnThisPage;\r\n\r\n    }\r\n\r\n    if (!paginationComponentElement) {\r\n      // If we're not paginating, then we need to ensure numRecordsDisplayed is equal to the number of total records.\r\n      this.numRecordsToDisplay = this.contents.body.rows.length;\r\n    }\r\n\r\n  }\r\n\r\n\r\n\r\n  render() {\r\n\r\n    let cssClass = 'yeti-table';\r\n\r\n    if (this.tableClass != '') {\r\n      cssClass += ' ' + this.tableClass;\r\n    }\r\n\r\n    return (\r\n      \r\n      <table class={cssClass}>\r\n\r\n        {( this.contents.head ) ?\r\n        \r\n          <thead class=\"yeti-table-head\">\r\n\r\n            <tr class=\"yeti-table-head-row\">\r\n\r\n              {( this.contents.head && this.contents.head.rows && this.contents.head.rows.length > 0 && this.contents.head.rows[0].cells && this.contents.head.rows[0].cells.length > 0) ?\r\n\r\n                this.contents.head.rows.map((row) => {\r\n                  return this.renderRow(row);\r\n                })\r\n\r\n              :\r\n\r\n                <th class=\"yeti-table-heading\" scope=\"col\">No data</th>\r\n\r\n              }\r\n                \r\n            </tr>\r\n\r\n          </thead>\r\n\r\n        :\r\n\r\n          \"\"\r\n\r\n        }\r\n\r\n\r\n        <tbody class=\"yeti-table-body\">\r\n\r\n          {\r\n            this.renderRows(this.firstRecordIndexToDisplay, this.numRecordsToDisplay)\r\n          }\r\n\r\n        </tbody>\r\n\r\n    </table>\r\n    );\r\n  }\r\n\r\n\r\n  componentDidRender() {\r\n    let paginationComponent = this.el.querySelector('yeti-table-pagination');\r\n    \r\n    if (paginationComponent != null) {\r\n\r\n      // If we're relying on the component consumer to handle pagination, then we get the record count from them.\r\n      // Otherwise, we use our own count of total rows (that passed filtering).\r\n      paginationComponent.records = (this.paginateSelf) ? this.rowsThatPassFiltering : this.records;\r\n\r\n    }\r\n\r\n    this.setFiltersActiveFlag(); // In case filters were programmatically updated (usually because the component consumer is keeping track of filter state on their end somehow)\r\n\r\n  }\r\n\r\n\r\n\r\n  componentDidLoad() {\r\n    // let datePickers = this.el.querySelectorAll(\".yeti-date-field\");\r\n\r\n    // datePickers.forEach((datePicker, key) => {\r\n      \r\n    //   let picker = datePicker as HTMLInputElement;\r\n      \r\n    //   picker.addEventListener(\"keydown\", (ev) => {\r\n\r\n    //     if (ev.key == \"Enter\") {\r\n    //       console.log(\"Gotcha\", key);\r\n    //     }\r\n\r\n    //   });\r\n\r\n    // });\r\n\r\n  }\r\n\r\n\r\n\r\n}"],"mappings":"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"}