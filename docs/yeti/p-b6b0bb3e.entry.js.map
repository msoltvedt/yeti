{"version":3,"names":["YetiFileExplorer","handleItemClick","e","depth","index","path","currentTarget","getAttribute","parentPath","substring","lastIndexOf","parentFolder","this","getFolderFromPath","setNewSelectedTerminus","updatePath","isSelected","selectedIndex","fileExplorerChange","emit","iLoveJSX","newFolderObject","folder","targetPath","folderNamesInPath","slice","split","model","root","i","length","currentTargetFolderNames","content","map","name","indexOf","targetFolder","clearTerminusPath","isTerminus","terminus","currentStepNameInPath","renderFolders","folders","emptyFolder","isRoot","minDisplayDepth","push","renderFolder","workingFolder","jsx","h","class","renderFolderContents","item","renderItem","buttonCSS","onClick","iconCode","alt","componentWillLoad","workingFolderContents","placeholderModel","offset","pageSize","totalElements","forEach","value","render","wrapperCSS","componentDidRender","folderElements","el","querySelectorAll","scrollIntoView","behavior","block"],"sources":["src/components/yeti-file-explorer/yeti-file-explorer.tsx"],"sourcesContent":["import { Component, Prop, h, State, Element, Event, EventEmitter, Method } from '@stencil/core';\r\nimport { YetiFileSystem, YetiFileSystemItem } from '../../utils/utils';\r\n\r\n@Component({\r\n  tag: 'yeti-file-explorer',\r\n  shadow: false,\r\n})\r\nexport class YetiFileExplorer {\r\n\r\n  /**\r\n   * Fires when the user clicks a folder\r\n   */\r\n  @Event() fileExplorerChange: EventEmitter;\r\n\r\n  @Element() el: HTMLElement;\r\n\r\n  /**\r\n   * CSS classlist applied to the explorer wrapper element.\r\n   */\r\n  @Prop({ attribute: 'wrapper-css'}) wrapperCSS?: string = '';\r\n\r\n  /**\r\n   * Whether or not to show files (folders are always shown).\r\n   */\r\n  @Prop() showFiles: boolean = true;\r\n\r\n  /**\r\n   * Data model object that describes the state and contents of the explorable file system. See utils.js for details.\r\n   */\r\n  @Prop({ mutable: true }) model: YetiFileSystem;\r\n\r\n  /**\r\n   * The YetiFileFolderContent object that is the last selected item in the path\r\n   */\r\n  @Prop({ mutable: true }) terminus: YetiFileSystemItem;\r\n\r\n  /**\r\n   * Toggle to trigger a re-render of the whole component.\r\n   */\r\n  @State() iLoveJSX: boolean = false;\r\n\r\n\r\n\r\n  handleItemClick(e: Event, depth: number = 0, index: number = 0) {\r\n    // A folder or file was just clicked. Handle it.\r\n    let path = (e.currentTarget as HTMLElement).getAttribute(\"data-path\");\r\n    let parentPath = path.substring( 0, path.lastIndexOf(\"/\") );\r\n    let parentFolder = this.getFolderFromPath(parentPath);\r\n\r\n    // 1. Update terminus and path\r\n    this.setNewSelectedTerminus(path); // Update the isSelected state of everything in the file system to point to the thing that was just clicked.\r\n    this.updatePath(path);\r\n\r\n    // 2. Update parent folder\r\n    parentFolder.isSelected = true;\r\n    parentFolder.selectedIndex = index;\r\n    \r\n    // 3. Fire item selected event. Include isFolder and path.\r\n    this.fileExplorerChange.emit({\r\n      \"path\": path,\r\n      \"depth\": depth,\r\n      \"index\": index\r\n    });\r\n\r\n    // 4. Rerender\r\n    this.iLoveJSX = !this.iLoveJSX;\r\n  }\r\n\r\n\r\n\r\n  @Method()\r\n  async newFolderObject() {\r\n    let folder: YetiFileSystemItem;\r\n    return folder;\r\n  }\r\n\r\n\r\n  \r\n  updatePath(targetPath) {\r\n    let folderNamesInPath = (targetPath.slice(1)).split('/'); // Array of folder names, e.g. /root/path/to/terminus is [\"root\", \"path\", \"to\", \"terminus\"]\r\n    let currentTarget = this.model.root;\r\n\r\n    for (let i=0; i<folderNamesInPath.length; i++) {\r\n        \r\n      let currentTargetFolderNames = currentTarget.content.map( content => content.name );\r\n\r\n      currentTarget.isSelected = true;\r\n      currentTarget.selectedIndex = currentTargetFolderNames.indexOf( folderNamesInPath[i] );\r\n\r\n      currentTarget = currentTarget.content[\r\n        currentTargetFolderNames.indexOf( folderNamesInPath[i] )\r\n      ]; // Move to the next step down the path\r\n\r\n    }\r\n\r\n  }\r\n\r\n\r\n\r\n  setNewSelectedTerminus(targetPath) {\r\n    // Set the isSelected state of everything in the file system to reflect that the new terminus is at depth targetDepth and index targetIndex.\r\n\r\n    let targetFolder: YetiFileSystemItem; // The folder we're updating in this function\r\n\r\n    // 1. Navigate to the correct depth\r\n    targetFolder = this.getFolderFromPath( targetPath );\r\n\r\n    // 2. Reset the previous terminus to the unselected state\r\n    this.clearTerminusPath();\r\n\r\n    // 3. Update to the new terminus\r\n    this.model.root.isSelected = true;\r\n    targetFolder.isSelected = true;\r\n    targetFolder.isTerminus = true;\r\n    this.terminus = targetFolder;\r\n  }\r\n\r\n\r\n\r\n  clearTerminusPath() {\r\n    // Deselects all folders along the path to terminus and sets the terminus internal variable to null\r\n    if (!this.terminus) {\r\n      return;\r\n    } else {\r\n\r\n      // Terminus was set. Unset it and unselect every folder in its path.\r\n\r\n      let folderNamesInPath = (this.terminus.path.slice(1)).split('/'); // Array of folder names, e.g. /root/path/to/terminus is [\"root\", \"path\", \"to\", \"terminus\"]\r\n      let currentTarget = this.model.root;\r\n\r\n      for (let i=0; i<folderNamesInPath.length; i++) {\r\n        \r\n        let currentTargetFolderNames = currentTarget.content.map( content => content.name );\r\n        currentTarget = currentTarget.content[\r\n          currentTargetFolderNames.indexOf( folderNamesInPath[i] )\r\n        ]; // Move to the next step down the path\r\n        currentTarget.isSelected = false;\r\n        currentTarget.isTerminus = false;\r\n      }\r\n\r\n      this.terminus = null;\r\n\r\n    }\r\n  }\r\n\r\n\r\n\r\n  getFolderFromPath(path: string) {\r\n    // path will be of format /folder/subfolder/subsubfolder/fileorfoldername\r\n    let folderNamesInPath;\r\n    let currentTarget = this.model.root;\r\n\r\n    if (path == \"\") {\r\n      return this.model.root;\r\n    }\r\n\r\n    path = path.slice(1); // Remove the leading slash\r\n    folderNamesInPath = path.split('/');\r\n\r\n    for (let i=0; i<folderNamesInPath.length; i++) {\r\n      // Work through the whole path until currentTarget points at the last one.\r\n      let currentStepNameInPath = folderNamesInPath[i];\r\n      let currentTargetFolderNames = currentTarget.content.map( content => content.name );\r\n      currentTarget = currentTarget.content[\r\n        currentTargetFolderNames.indexOf(currentStepNameInPath)\r\n      ]\r\n    }\r\n\r\n    return currentTarget;\r\n  }\r\n\r\n\r\n\r\n  renderFolders() {\r\n    // Render all the displayed folders for the currently selected path.\r\n    let folders = [];\r\n    let emptyFolder: YetiFileSystemItem = {\r\n      name: \"\",\r\n      path: \"/\",\r\n      content: [],\r\n      selectedIndex: -1,\r\n      isRoot: false,\r\n      isSelected: false,\r\n      isTerminus: false\r\n    }\r\n\r\n    \r\n    // First, handle the initial or reset state where the path is empty\r\n    if (this.model.root.content.length == 0) {\r\n\r\n      for (let i=0; i<this.model.minDisplayDepth; i++) {\r\n        folders.push(\r\n          this.renderFolder(\r\n            (i == 0) ? this.model.root : emptyFolder // Show the root folder and then empty ones to fill out the rest of the display depth\r\n          )\r\n        )\r\n      }\r\n      \r\n    } else {\r\n\r\n      let workingFolder = this.model.root;\r\n      do {\r\n        folders.push(this.renderFolder(workingFolder));\r\n        workingFolder = workingFolder.content[ workingFolder.selectedIndex ];\r\n      } while (workingFolder && workingFolder.isSelected);\r\n\r\n    }\r\n\r\n    return folders;\r\n\r\n  }\r\n\r\n\r\n\r\n  renderFolder(folder: YetiFileSystemItem) {\r\n\r\n    let depth = folder.path.split(\"/\").length-1;\r\n\r\n    let jsx =\r\n\r\n      <div class=\"yeti-file_explorer-folder\">\r\n\r\n        <ul class=\"yeti-file_explorer-folder-items\">\r\n\r\n          {this.renderFolderContents(folder, depth)}\r\n\r\n        </ul>\r\n\r\n      </div>\r\n\r\n    return jsx;\r\n      \r\n  }\r\n\r\n\r\n\r\n  renderFolderContents(folder: YetiFileSystemItem, depth: number = -1) {\r\n\r\n    return folder.content.map((item, index) => {\r\n      return this.renderItem(item, depth, index);\r\n    });\r\n\r\n  }\r\n\r\n\r\n\r\n  renderItem(item: YetiFileSystemItem, depth: number = -1, index: number = -1) {\r\n\r\n    let buttonCSS = \"yeti-file_explorer-folder-item-wrapper\" + ((item.isSelected) ? \" yeti-file_explorer-folder-item-wrapper__selected\" : \"\");\r\n    let jsx = \r\n\r\n      <li class=\"yeti-file_explorer-folder-item\">\r\n\r\n          <button class={buttonCSS} onClick={(e) => { this.handleItemClick(e, depth, index); }} data-path={item.path}>\r\n\r\n              <yeti-icon iconCode=\"folder\" alt=\"subfolder\" icon-style=\"outlined\" class=\"yeti-file_explorer-folder-item-icon\"></yeti-icon>\r\n            \r\n              <span class=\"yeti-file_explorer-folder-item-name\">{item.name}</span>\r\n            \r\n              {/* {\r\n                (item.content.length) ? \r\n                  <yeti-icon iconCode=\"chevron_right\" alt=\"open subfolder\" class=\"yeti-file_explorer-folder-more\"></yeti-icon>\r\n                : \r\n                  \"\"\r\n              } */}\r\n\r\n              <yeti-icon iconCode=\"chevron_right\" alt=\"open subfolder\" class=\"yeti-file_explorer-folder-more\"></yeti-icon>\r\n        \r\n          </button>\r\n\r\n      </li>\r\n\r\n    return jsx;\r\n  }\r\n\r\n\r\n\r\n  componentWillLoad() {\r\n\r\n    let workingFolderContents: YetiFileSystemItem[];\r\n    \r\n    if (!this.model) {\r\n      // The model doesn't exist yet, so we have to create a dummy one.\r\n      let placeholderModel: YetiFileSystem = {\r\n        root: {\r\n          name: \"\",\r\n          path: \"/\",\r\n          content: [],\r\n          selectedIndex: -1,\r\n          offset: 0,\r\n          pageSize: 0,\r\n          totalElements: 0,\r\n          isRoot: true,\r\n          isSelected: false,\r\n          isTerminus: false\r\n        },\r\n        minDisplayDepth: 3\r\n      }\r\n\r\n      this.model = placeholderModel;\r\n    }\r\n\r\n    // Initialize path\r\n    workingFolderContents = this.model.root.content;\r\n\r\n    workingFolderContents.forEach((value, index) => {\r\n      if (value.isSelected) {\r\n        value.selectedIndex = index;\r\n      }\r\n    });\r\n\r\n  }\r\n\r\n\r\n\r\n  render() {\r\n\r\n    let wrapperCSS = 'yeti-file_explorer-wrapper';\r\n\r\n    wrapperCSS += (this.wrapperCSS != '') ? ` ${this.wrapperCSS}` : '';\r\n\r\n    return (\r\n\r\n      <div class={wrapperCSS}>\r\n\r\n        <div class=\"yeti-file_explorer\">\r\n\r\n          <div class=\"yeti-file_explorer-folders\">\r\n\r\n            {this.renderFolders()}\r\n\r\n          </div>{/* /folders */}\r\n\r\n        </div>{/* /file_explorer */}\r\n\r\n      \r\n        <div class=\"yeti-file_explorer-path\">{(this.terminus) ? this.terminus.path : ''}</div>\r\n\r\n      </div>\r\n\r\n    );\r\n  }\r\n\r\n\r\n\r\n  componentDidRender() {\r\n    // Scroll the last folder into view\r\n    let folderElements = this.el.querySelectorAll(\".yeti-file_explorer-folder\");\r\n\r\n    if (folderElements && folderElements.length) {\r\n      folderElements[ folderElements.length-1 ].scrollIntoView({\r\n        behavior: \"smooth\",\r\n        block: \"nearest\"\r\n      });\r\n    }\r\n  }\r\n\r\n}"],"mappings":"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"}