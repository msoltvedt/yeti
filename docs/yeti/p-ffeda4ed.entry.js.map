{"version":3,"names":["YetiPageContents","this","headings","initializeObserver","document","querySelectorAll","observer","options","root","rootMargin","threshold","IntersectionObserver","handleIntersect","forEach","heading","observe","entries","entry","myCorrespondingEntry","querySelector","target","id","isIntersecting","classList","add","remove","componentWillLoad","elId","el","elsParent","elsGrandparent","headingElements","pageWrapper","createElement","setAttribute","utils","generateUniqueId","wrapperId","parentElement","console","warn","insertBefore","appendChild","i","length","newHeading","label","level","innerText","parseInt","substring","push","render","h","key","class","map","css","href","myId","onClick","e","preventDefault","stopImmediatePropagation","getElementById","scrollIntoView","behavior","inline","body"],"sources":["src/components/yeti-page-contents/yeti-page-contents.tsx"],"sourcesContent":["import { Component, Prop, h, Element } from '@stencil/core';\r\nimport { utils, YetiPageContentsHeader } from '../../utils/utils';\r\n\r\n@Component({\r\n  tag: 'yeti-page-contents',\r\n  shadow: false,\r\n})\r\nexport class YetiPageContents {\r\n\r\n  @Element() el: HTMLElement;\r\n\r\n  /**\r\n   * Whether to show the Page Contents menu in expanded or closed state.\r\n   */\r\n  @Prop() isExpanded: boolean = false;\r\n\r\n\r\n  /**\r\n   * Whether to show the Page Contents menu in expanded or closed state.\r\n   */\r\n  @Prop() wrapperId: string = \"\"; // Will be set in componentWillLoad;\r\n\r\n\r\n  /**\r\n   * An array of objects containing the heading names and ids.\r\n   */\r\n  headings: YetiPageContentsHeader[] = []; // Will be set in componentWillLoad;\r\n\r\n\r\n\r\n  initializeObserver() {\r\n    // Set up the Intersection Observer stuff (so we can style the list item whose heading is in view)\r\n\r\n    let headings = document.querySelectorAll('h1, h2, h3, h4, h5, h6');\r\n    let observer;\r\n    let options = {\r\n      root: null,\r\n      rootMargin: '0px',\r\n      threshold: 1\r\n    };\r\n\r\n    observer = new IntersectionObserver(handleIntersect, options);\r\n\r\n    headings.forEach(heading => {\r\n      observer.observe(heading);\r\n    });\r\n\r\n    function handleIntersect(entries) {\r\n      \r\n      entries.forEach( (entry) => {\r\n\r\n        let myCorrespondingEntry = document.querySelector(`#${entry.target.id}_entry`);\r\n        //let allCorrespondingEntries = document.querySelectorAll(\".yeti-page_contents-heading\");\r\n\r\n        if (entry.isIntersecting) {\r\n\r\n          // allCorrespondingEntries.forEach( oneOfAllEntries => {\r\n          //   oneOfAllEntries.classList.remove(\"yeti-page_contents-heading__visible\");\r\n          // });\r\n\r\n          myCorrespondingEntry.classList.add(\"yeti-page_contents-heading__visible\");\r\n        \r\n        } else {\r\n\r\n          myCorrespondingEntry.classList.remove(\"yeti-page_contents-heading__visible\");\r\n        }\r\n\r\n      });\r\n\r\n    }\r\n\r\n  }\r\n  \r\n\r\n\r\n  componentWillLoad() {\r\n    \r\n    let elId = this.el.id;\r\n    let elsParent;\r\n    let elsGrandparent;\r\n    let headingElements;\r\n    let pageWrapper = document.createElement(\"div\");\r\n    pageWrapper.classList.add(\"yeti-page_contents-wrapper\");\r\n\r\n    // Hide this whole component from screen-readers (since they have a better version built in)\r\n    this.el.setAttribute(\"aria-hidden\", \"true\");\r\n\r\n    // Set up ids\r\n    if (!elId) {\r\n      elId = utils.generateUniqueId();\r\n      this.wrapperId = `${elId}_wrapper`;\r\n    }\r\n\r\n    // Set up page structure:\r\n    // - Wrap el's parent in a new div with class .yeti-page_contents-wrapper\r\n    // - Move the parent into that div\r\n    // - Make el a sibling of parent\r\n    elsParent = this.el.parentElement;\r\n    elsGrandparent = elsParent.parentElement;\r\n\r\n    if (!elsParent || !elsGrandparent) {\r\n      console.warn(\"yeti-page-contents requires containing parent and grandparent elements.\");\r\n      return;\r\n    }\r\n\r\n    elsParent.classList.add(\"yeti-page_contents-wrappee\");\r\n\r\n    elsGrandparent.insertBefore(pageWrapper, elsParent);\r\n    pageWrapper.appendChild(elsParent);\r\n    pageWrapper.appendChild(this.el);\r\n\r\n    // Build the list of headings\r\n    headingElements = elsParent.querySelectorAll(\"h1, h2, h3, h4, h5, h6\");\r\n\r\n    for (let i = 0; i < headingElements.length; i++) {\r\n      \r\n      let heading = headingElements[i]; // Actual heading HTMLElement\r\n      let newHeading: YetiPageContentsHeader = {\r\n        label: \"\",\r\n        id: \"\",\r\n        level: 1\r\n      };\r\n\r\n      heading.id = (heading.id && heading.id != '') ? heading.id : utils.generateUniqueId(); // If the id doesn't have an id then give it one.\r\n\r\n      newHeading.label = heading.innerText;\r\n      newHeading.id = heading.id;\r\n      newHeading.level = parseInt((heading.nodeName).substring(1)); // Get the \"n\" in Hn (e.g. 2 in H2)\r\n      \r\n      this.headings.push(newHeading);\r\n    }\r\n\r\n    this.initializeObserver();\r\n\r\n  }\r\n\r\n\r\n\r\n  render() {\r\n\r\n    return (\r\n      \r\n      <div class=\"yeti-page_contents\" id={this.wrapperId}>\r\n\r\n        <ul class=\"yeti-page_contents-headings\">\r\n\r\n          {this.headings.map((heading) => {\r\n\r\n              let css = `yeti-page_contents-heading yeti-page_contents-heading-level-${heading.level}`;\r\n              let href = `#${heading.id}`;\r\n              let myId = `${heading.id}_entry`;\r\n              let label = heading.label;\r\n\r\n              return <li class={css} id={myId} key={myId}>\r\n                <a href={href} onClick={(e) => {\r\n                  e.preventDefault();\r\n                  e.stopImmediatePropagation();\r\n                  document.getElementById(heading.id).scrollIntoView({ behavior: \"smooth\", inline: \"start\" });\r\n                }}>{label}</a>\r\n              </li>;\r\n            })\r\n          }\r\n          <li class='yeti-page_contents-heading yeti-page_contents-heading-level-2'>\r\n            <a href='' onClick={(e) => {\r\n              e.preventDefault();\r\n              e.stopImmediatePropagation();\r\n              document.body.scrollIntoView({ behavior: \"smooth\", inline: \"start\" });\r\n            }}>Top</a>\r\n          </li>\r\n\r\n        </ul>\r\n\r\n      </div>\r\n\r\n    );\r\n  }\r\n  \r\n\r\n}\r\n"],"mappings":"4FAOaA,EAAgB,M,yBAmB3BC,KAAAC,SAAqC,G,gBAZP,M,eAMF,E,CAU5B,kBAAAC,GAGE,IAAID,EAAWE,SAASC,iBAAiB,0BACzC,IAAIC,EACJ,IAAIC,EAAU,CACZC,KAAM,KACNC,WAAY,MACZC,UAAW,GAGbJ,EAAW,IAAIK,qBAAqBC,EAAiBL,GAErDL,EAASW,SAAQC,IACfR,EAASS,QAAQD,EAAQ,IAG3B,SAASF,EAAgBI,GAEvBA,EAAQH,SAAUI,IAEhB,IAAIC,EAAuBd,SAASe,cAAc,IAAIF,EAAMG,OAAOC,YAGnE,GAAIJ,EAAMK,eAAgB,CAMxBJ,EAAqBK,UAAUC,IAAI,sC,KAE9B,CAELN,EAAqBK,UAAUE,OAAO,sC,MAW9C,iBAAAC,GAEE,IAAIC,EAAO1B,KAAK2B,GAAGP,GACnB,IAAIQ,EACJ,IAAIC,EACJ,IAAIC,EACJ,IAAIC,EAAc5B,SAAS6B,cAAc,OACzCD,EAAYT,UAAUC,IAAI,8BAG1BvB,KAAK2B,GAAGM,aAAa,cAAe,QAGpC,IAAKP,EAAM,CACTA,EAAOQ,EAAMC,mBACbnC,KAAKoC,UAAY,GAAGV,W,CAOtBE,EAAY5B,KAAK2B,GAAGU,cACpBR,EAAiBD,EAAUS,cAE3B,IAAKT,IAAcC,EAAgB,CACjCS,QAAQC,KAAK,2EACb,M,CAGFX,EAAUN,UAAUC,IAAI,8BAExBM,EAAeW,aAAaT,EAAaH,GACzCG,EAAYU,YAAYb,GACxBG,EAAYU,YAAYzC,KAAK2B,IAG7BG,EAAkBF,EAAUxB,iBAAiB,0BAE7C,IAAK,IAAIsC,EAAI,EAAGA,EAAIZ,EAAgBa,OAAQD,IAAK,CAE/C,IAAI7B,EAAUiB,EAAgBY,GAC9B,IAAIE,EAAqC,CACvCC,MAAO,GACPzB,GAAI,GACJ0B,MAAO,GAGTjC,EAAQO,GAAMP,EAAQO,IAAMP,EAAQO,IAAM,GAAMP,EAAQO,GAAKc,EAAMC,mBAEnES,EAAWC,MAAQhC,EAAQkC,UAC3BH,EAAWxB,GAAKP,EAAQO,GACxBwB,EAAWE,MAAQE,SAAUnC,EAAgB,SAAEoC,UAAU,IAEzDjD,KAAKC,SAASiD,KAAKN,E,CAGrB5C,KAAKE,oB,CAMP,MAAAiD,GAEE,OAEEC,EAAA,OAAAC,IAAA,2CAAKC,MAAM,qBAAqBlC,GAAIpB,KAAKoC,WAEvCgB,EAAA,MAAAC,IAAA,2CAAIC,MAAM,+BAEPtD,KAAKC,SAASsD,KAAK1C,IAEhB,IAAI2C,EAAM,+DAA+D3C,EAAQiC,QACjF,IAAIW,EAAO,IAAI5C,EAAQO,KACvB,IAAIsC,EAAO,GAAG7C,EAAQO,WACtB,IAAIyB,EAAQhC,EAAQgC,MAEpB,OAAOO,EAAA,MAAIE,MAAOE,EAAKpC,GAAIsC,EAAML,IAAKK,GACpCN,EAAA,KAAGK,KAAMA,EAAME,QAAUC,IACvBA,EAAEC,iBACFD,EAAEE,2BACF3D,SAAS4D,eAAelD,EAAQO,IAAI4C,eAAe,CAAEC,SAAU,SAAUC,OAAQ,SAAU,GACzFrB,GACD,IAGTO,EAAA,MAAAC,IAAA,2CAAIC,MAAM,iEACRF,EAAA,KAAAC,IAAA,2CAAGI,KAAK,GAAGE,QAAUC,IACnBA,EAAEC,iBACFD,EAAEE,2BACF3D,SAASgE,KAAKH,eAAe,CAAEC,SAAU,SAAUC,OAAQ,SAAU,GACtE,S"}