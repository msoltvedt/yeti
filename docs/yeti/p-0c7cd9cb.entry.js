import{r as e,h as t,g as i}from"./p-028ac5ad.js";import{u as s}from"./p-5c303e9a.js";const a=class{constructor(t){e(this,t),this.tableClass="",this.tableId=s.generateUniqueId(),this.contents={head:{rows:[{cells:[{value:"Data"}]}]},body:{rows:[{cells:[{value:"This table has no data."}]}]}},this.contentsActual=void 0,this.isValid=!0,this.iLoveJSX=!0}watchContentsHandler(e){return e.body?e.body.rows?void 0:(console.error("Supplied data must have rows in table body."),!1):(console.error("Supplied data has no table body."),!1)}handlePaginationUpdate(){this.iLoveJSX=!this.iLoveJSX}handleReadyToVerify(e){let t=e.target,i=parseInt(t.getAttribute("data-column"));switch(t.nodeName.toLowerCase()){case"yeti-date-picker":return void this.handleDateFilterChange(e.target,i);case"yeti-multiselect":return void this.handleMultiselectFilterChange(e.target,i)}}isValidTableData(e){return s.isValidJSON(e)?(e=JSON.stringify(e),e=JSON.parse(e),!0):(console.error("Error in yeti-table; supplied data was not valid JSON."),!0)}setHeadingColumnIndices(){this.contents.head.rows.forEach(((e,t)=>{e.rowIndex=t,e.cells.forEach(((e,t)=>{e.columnIndex=t}))}))}setBodyColumnIndices(){this.contents.body.rows.forEach(((e,t)=>{e.rowIndex=t,e.cells.forEach(((e,t)=>{e.columnIndex=t}))}))}setSortableOnCellsOtherThanTheOneWithThisIndex(e){let t=this.contents.head.rows[0].cells;for(let i=0,s=t[0];i<t.length;i++,s=t[i])s.sortDirection&&(s.sortDirection=s.columnIndex==e?s.sortDirection:"unsorted")}setDefaultFilterValues(){this.contents.head.rows.forEach((e=>{e.cells.forEach((e=>{e.filtering&&!e.filtering.value&&(e.filtering.value="")}))}))}handleSort(e){this.contents.body.rows.sort(((t,i)=>{let a=t.cells[e.columnIndex].value,l=i.cells[e.columnIndex].value,n=s.getStringifiedType(a),r=s.getStringifiedType(l),d="ascending"==e.sortDirection?-1:1;if(n!=r)if(d>0)switch(n){case"number":case"string":return-1;default:return 1}else switch(n){case"date":case"string":return-1;default:return 1}switch(n){case"number":return(s.castToNumber(a)-s.castToNumber(l))*d;case"string":return a==l?0:a<l?-1*d:1*d;case"date":{let e=new Date(a),t=new Date(l);return e==t?0:e<t?-1*d:1*d}}})),e.sortDirection="ascending"==e.sortDirection?"descending":"ascending",this.setSortableOnCellsOtherThanTheOneWithThisIndex(e.columnIndex),this.iLoveJSX=!this.iLoveJSX}handleTextFilterChange(e,t){this.contents.head.rows[0].cells[t].filtering.value=e.value,this.iLoveJSX=!this.iLoveJSX}handleSelectFilterChange(e,t){this.contents.head.rows[0].cells[t].filtering.value=0==e.selectedIndex?"":e.value,this.iLoveJSX=!this.iLoveJSX}handleDateFilterChange(e,t){this.contents.head.rows[0].cells[t].filtering.value=e.value,this.iLoveJSX=!this.iLoveJSX}handleMultiselectFilterChange(e,t){this.contents.head.rows[0].cells[t].filtering.value=e.value,this.iLoveJSX=!this.iLoveJSX}doesRowPassFiltering(e){for(let t=0;t<e.cells.length;t++)if(!this.doesCellPassFiltering(e.cells[t]))return!1;return!0}doesCellPassFiltering(e){let t=this.contents.head.rows[0].cells[e.columnIndex];if(!t.filtering||!t.filtering.isFilterable)return!0;{let i=t.filtering.value;switch(t.filtering.type){case"text":return e.value.indexOf(i)>=0;case"select":return e.value.indexOf(i)>=0||""==i;case"date":return""==i||new Date(i).getTime()==new Date(e.value).getTime();case"multiselect":return""==i||i.split(",").includes(e.value);default:return console.error("Error in table data: unexpected filtering type supplied."),!1}}}renderCell(e){let i=e.cssClass&&""!=e.cssClass?" "+e.cssClass:"";return e.id=e.id?e.id:s.generateUniqueId(),e.isHeading?this.renderTableHeading(e):t("td",{class:"yeti-table-cell"+i,key:e.id},e.value)}renderTableHeading(e){let i=e.cssClass&&""!=e.cssClass?" "+e.cssClass:"";if(e.isHeading){let a=s.generateUniqueId();if(e.sortDirection){let s,l,n,r="";switch(e.sortDirection=e.sortDirection.toLowerCase(),e.sortDirection){case"ascending":l="Sorted ascending",n="expand_less";break;case"descending":l="Sorted descending",n="expand_more";break;default:l="Sortable",n="unfold_more"}return e.filtering&&e.filtering.isFilterable&&(r=t("div",{class:"yeti-table-heading-filter"},this.renderTableHeadingFilter(e,a))),s=t("th",{class:`yeti-table-heading ${i}`},t("div",{class:"yeti-table-heading-compound"},t("button",{class:"yeti-table-heading-button",onClick:()=>{this.handleSort(e)}},t("div",{class:"yeti-table-heading-button-label",id:a},e.value),t("span",{class:"yeti-table-heading-button-icon"},t("span",{class:"yeti-a11y-hidden"},l),t("span",{class:"material-icons","aria-hidden":"true",title:l},n))),r||"")),s}return t("th",{class:"yeti-table-heading"+i,key:e.id},e.filtering&&e.filtering.isFilterable?t("div",{class:"yeti-table-heading-compound"},t("div",{class:"yeti-table-heading-compound-actual",id:a},e.value),t("div",{class:"yeti-table-heading-filter"},this.renderTableHeadingFilter(e,a))):e.value)}console.error("Error rendering table cell: expected th, got td.")}renderTableHeadingFilter(e,i){switch(e.filtering.type){case"text":return t("input",{type:"text",value:this.contents.head.rows[0].cells[e.columnIndex].filtering.value,class:"yeti-input yeti-table-heading-filter-input",onKeyUp:t=>{this.handleTextFilterChange(t.target,e.columnIndex)},"aria-labelledby":i});case"select":let s=[];if(!(e.filtering.options&&e.filtering.options.length>0))return console.error("Error in table select filter: no options supplied."),!1;for(let i=0;i<e.filtering.options.length;i++)s.push(t("option",null,e.filtering.options[i]));return t("select",{class:"yeti-select yeti-table-heading-filter-input",onChange:t=>{this.handleSelectFilterChange(t.target,e.columnIndex)},"aria-labelledby":i},t("option",null,"-Any-"),s);case"date":return t("yeti-date-picker",{"data-column":e.columnIndex,"labelled-by":i});case"multiselect":let a=[];if(!(e.filtering.options&&e.filtering.options.length>0))return console.error("Error in table multiselect filter: no options supplied."),!1;for(let i=0;i<e.filtering.options.length;i++)a.push(t("yeti-multiselect-option",null,e.filtering.options[i]));return t("yeti-multiselect",{placeholder:"-Any-","data-column":e.columnIndex,"labelled-by":i},a);default:return console.error("Error rendering table filter: unexpected filtering type requested:",e.filtering.type),""}}renderRow(e){let t=[];return e.cells.map((e=>{t.push(this.renderCell(e))})),t}renderRows(e=0,i=this.contents.body.rows.length-1){let a=[],l=0;for(let n=e;n<=i;n++){const e=this.contents.body.rows[n];this.doesRowPassFiltering(e)&&(++l,e.id=e.id?e.id:s.generateUniqueId(),a.push(t("tr",{class:"yeti-table-body-row",key:e.id},this.renderRow(e))))}return l>0?a:t("tr",{class:"yeti-table-body-row"},t("td",{class:"yeti-table-cell",colSpan:this.contents.head.rows[0].cells.length},"No matches"))}componentWillLoad(){this.watchContentsHandler(this.contents),this.setHeadingColumnIndices(),this.setBodyColumnIndices(),this.setDefaultFilterValues()}render(){let e="yeti-table",i=this.el.querySelector("yeti-table-pagination"),a=0,l=this.contents.body.rows.length-1;return null!=i&&(i.records=this.contents.body.rows.length,i.id=i.id?i.id:s.generateUniqueId(),a=i.startIndex-1,l=i.endIndex-1),""!=this.tableClass&&(e+=" "+this.tableClass),0==this.isValid&&(e+=" yeti-input__error"),t("table",{class:e},t("thead",{class:"yeti-table-head"},t("tr",{class:"yeti-table-head-row"},this.contents.head.rows.map((e=>this.renderRow(e))))),t("tbody",{class:"yeti-table-body"},this.renderRows(a,l)))}get el(){return i(this)}static get watchers(){return{contents:["watchContentsHandler"]}}};export{a as yeti_table}