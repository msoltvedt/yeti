{"version":3,"names":["YetiModal","this","previouslyFocusedElement","bodyInnerWrapper","shouldStealFocus","shouldReturnFocus","headingId","utils","generateUniqueId","handleFocus","newValue","setBackgroundElementStyles","modalIsActivating","document","body","classList","add","remove","focusTrap","e","isActive","keyCode","showClose","handleInitialFocus","contentArea","el","querySelector","firstFocusableContentItem","aria","focusFirstDescendant","setAttribute","focus","componentWillLoad","componentId","getAttribute","content","buttons","console","error","render","modalOverlayCSS","modalCSS","modalProperties","role","describedBy","size","h","class","tabIndex","Object","assign","id","heading","onClick","name","componentDidRender","activeElement","componentDidLoad","frontBumper","backBumper","addEventListener","focusLastDescendant"],"sources":["src/components/yeti-modal/yeti-modal.tsx"],"sourcesContent":["import { Component, Prop, h, Element, Watch, Listen } from '@stencil/core';\nimport { utils } from '../../utils/utils';\n\n@Component({\n  tag: 'yeti-modal',\n  shadow: false,\n})\nexport class YetiModal {\n\n  @Element() el: HTMLElement;\n\n  /**\n   * The string that will display in the modal's heading and serve as its title.\n   */\n  @Prop() heading: string = \"Modal Heading\";\n\n  /**\n   * The optional id of an element that describes the modal's content.\n   */\n  @Prop() describedBy: string = \"\";\n\n  /**\n   * The optional size of the modal (other than the default). Options are xl, l, s, xs.\n   */\n  @Prop() size: string = \"\";\n\n  /**\n   * Optional CSS classes to add to the modal element.\n   */\n  @Prop({ attribute: 'modal-css'}) modalCSS: string = \"\";\n\n  /**\n   * Whether overflowing contents are shown via scrolling or clipped.\n   */\n  @Prop() isScrollable: boolean = true;\n\n  /**\n   * Tracks whether the Modal is displaying or not.\n   */\n  @Prop({\n    mutable: true,\n    reflect: true\n  }) isActive: boolean = false;\n  @Watch('isActive')\n  handleFocus(newValue: boolean) {\n    // When the Loading becomes active it should take focus away from whatever had it before, but\n    // we want to keep track of what that was so we can return focus if Loading becomes inactive.\n\n    // Becoming active, take focus\n    if (newValue) {\n      this.shouldStealFocus = true;\n      this.setBackgroundElementStyles(true);\n    }\n\n    // Becoming inactive, return focus\n    else {\n      this.shouldReturnFocus = true;\n      this.setBackgroundElementStyles(false);\n    }\n  }\n\n  /**\n   * Choose to show the close icon (currently an X) or not\n   */\n  @Prop() showClose: boolean = true;\n\n\n  previouslyFocusedElement: HTMLElement = null; // So we can return focus to wherever the user was when the Loading component appeared.\n  bodyInnerWrapper: HTMLElement = null; // A div wrapped around everything in the body except the modal. Used to prevent background scrolling.\n  shouldStealFocus = false;\n  shouldReturnFocus = false;\n  headingId = utils.generateUniqueId();\n  \n\n\n  setBackgroundElementStyles(modalIsActivating: boolean) {\n    if (modalIsActivating) {\n        document.body.classList.add(\"yeti-modal-has_active_modal\");\n    } else {\n        document.body.classList.remove(\"yeti-modal-has_active_modal\");\n    }\n  }\n\n\n\n  @Listen('keydown', { target: 'window'})\n  focusTrap(e) {\n\n    if (this.isActive && e.keyCode == 27 && this.showClose) { // Escape button\n        this.isActive = false;    \n    }\n\n  }\n\n\n\n  handleInitialFocus() {\n    // Sets focus on the correct thing within the modal's content when it first opens. If nothing is focusable, uses the content area itself.\n    let contentArea = this.el.querySelector('.yeti-modal-content') as HTMLElement;\n    let firstFocusableContentItem = utils.aria.focusFirstDescendant(contentArea); // either false or an HTMLElement\n\n    if (!firstFocusableContentItem) {\n        // There is nothing focusable within the content of the modal, so make the content area itself focusable.\n        contentArea.setAttribute(\"tabIndex\", \"-1\");\n        contentArea.focus();\n    }\n  }\n\n\n\n  componentWillLoad() {\n    // Set up ids and handle slotted content\n    let componentId = this.el.getAttribute(\"id\");\n    let content = this.el.querySelector(\"yeti-modal-content\");\n    let buttons = this.el.querySelector(\"yeti-modal-buttons\");\n\n    if (!content) {\n        console.error(\"Yeti Modal components must have a yeti-modal-content element.\");\n    } else {\n        content.setAttribute(\"slot\", \"content\");\n    }\n\n    if (!buttons) {\n        console.error(\"Yeti Modal components must have a yeti-modal-buttons element.\");\n    } else {\n        buttons.setAttribute(\"slot\", \"buttons\");\n    }\n\n    if (!componentId || componentId == \"\") {\n      componentId = utils.generateUniqueId();\n      this.el.setAttribute(\"id\", componentId);\n    }\n\n  }\n\n\n  render() {\n\n    let modalOverlayCSS = \"yeti-modal-overlay\";\n    let modalCSS = \"yeti-modal\";\n    let modalProperties = {\n        \"role\": \"dialog\",\n        \"aria-modal\": \"true\",\n        \"aria-labelledby\": this.headingId\n    };\n\n    if (this.describedBy != \"\") {\n        modalProperties[\"aria-describedby\"] = this.describedBy;\n    }\n\n    modalOverlayCSS += (this.isActive) ? \"\" : \" yeti-modal-overlay__inert\";\n\n    modalCSS += (this.size == \"\") ? \"\" : ` yeti-modal-size-${this.size}`;\n\n    modalCSS += (this.modalCSS != \"\") ? ` ${this.modalCSS}` : \"\";\n\n    modalCSS += (this.isScrollable) ? \"\" : \" yeti-modal__unscrollable\";\n\n    return (\n        <div class={modalOverlayCSS}>\n            \n            <div class=\"yeti-modal-bumper-front\" tabIndex={0}></div>\n\n\n            <div class={modalCSS} {...modalProperties}>\n        \n                <div class=\"yeti-modal-header\">\n                    <h1 class=\"yeti-modal-header-heading\" id={this.headingId}>{this.heading}</h1>\n\n                    {(this.showClose) ?\n\n                      <button class=\"yeti-modal-header-close yeti-button-ghost\" onClick={() => { this.isActive = false }}>\n                      <span class=\"material-icons\">close</span>\n                      </button>\n\n                    :\n\n                      null\n\n                    }\n                    \n                </div>\n\n        \n                <div class=\"yeti-modal-content\">\n\n                    <slot name=\"content\" />\n        \n                    <div class=\"yeti-modal-content-fade\"></div>\n        \n                </div>\n\n        \n                <div class=\"yeti-modal-actions\">\n\n                    <div class=\"yeti-modal-actions-buttons\">\n                    \n                        <slot name=\"buttons\" />\n                    \n                    </div>\n                \n                </div>\n        \n            </div>\n\n\n            <div class=\"yeti-modal-bumper-back\" tabIndex={0}></div>\n\n        </div>\n\n    );\n  }\n\n\n\n  componentDidRender() {\n    // Handle focus management. We can't do this when the property changes because the inactive state uses display: none,\n    // which interferes with the ability to accept focus depending on some race conditions.\n\n    if (this.shouldStealFocus) {\n      // Becoming active, take focus\n      this.previouslyFocusedElement = document.activeElement as HTMLElement;\n      //utils.aria.focusFirstDescendant(this.el);\n      this.handleInitialFocus();\n    }\n\n    if (this.shouldReturnFocus) {\n      // Becoming inactive, return focus\n      if (this.previouslyFocusedElement) {\n        this.previouslyFocusedElement.focus();\n      }\n    }\n\n    this.shouldStealFocus = false;\n    this.shouldReturnFocus = false;\n  }\n\n\n\n  componentDidLoad() {\n    let frontBumper = this.el.querySelector(\".yeti-modal-bumper-front\");\n    let backBumper  = this.el.querySelector(\".yeti-modal-bumper-back\");\n\n    frontBumper.addEventListener(\"focus\", () => {\n        utils.aria.focusLastDescendant(this.el.querySelector(\".yeti-modal\"));\n    });\n\n    backBumper.addEventListener(\"focus\", () => {\n        utils.aria.focusFirstDescendant(this.el.querySelector(\".yeti-modal\"));\n    });\n  }\n\n}"],"mappings":"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"}